/**
                             *******************
*******************************    C  FILE    ********************************
**                           *******************                            **
**                                                                          **
**  Project     :                                                           **
**  Filename    : parser_char.c                                             **
**  Version     : -.- (PCB : )                                              ** 
**  Revised by  :                                                           **
**  Date        : 2025.04.26                                                **
**                                                                          **
******************************************************************************/


/*********************************************************************************************************************/
/*----------------------------------------------------Includes-------------------------------------------------------*/
/*********************************************************************************************************************/

#include "parser_char.h"

#include <stdbool.h>

/*********************************************************************************************************************/
/*-----------------------------------------------------Macro---------------------------------------------------------*/
/*********************************************************************************************************************/


/*********************************************************************************************************************/
/*----------------------------------------------------Interrupt------------------------------------------------------*/
/*********************************************************************************************************************/


/*********************************************************************************************************************/
/*-------------------------------------------------Global Variable---------------------------------------------------*/
/*********************************************************************************************************************/


/*********************************************************************************************************************/
/*-------------------------------------------------Data Structures---------------------------------------------------*/
/*********************************************************************************************************************/


/*********************************************************************************************************************/
/*-----------------------------------------------Function Prototypes-------------------------------------------------*/
/*********************************************************************************************************************/


/*********************************************************************************************************************/
/*-------------------------------------------------Private Function--------------------------------------------------*/
/*********************************************************************************************************************/

static bool ParserChar_IsASCIIText(uint8_t text)
{
    if(text < 127) return true;

    return false;
}

static bool ParserChar_IsKoreanText(const uint8_t *text, uint8_t startIndex)
{
    if(
        ((text[startIndex]   & 0b11100000) && !(text[startIndex]   & 0b00010000)) &&
        ((text[startIndex+1] & 0b10000000) && !(text[startIndex+1] & 0b01000000)) &&
        ((text[startIndex+2] & 0b10000000) && !(text[startIndex+2] & 0b01000000))
    )
    {
        return true;
    }  
  
  return false;
}

static uint32_t ParserChar_GetUnicodeNumOfKorean(const uint8_t *text, uint8_t startIndex)
{ 
    uint32_t num1 = 0, num2 = 0, num3 = 0;

    num1 = text[startIndex] - 0b11100000;
    num1 = num1 << 12;

    num2 = text[startIndex + 1] - 0b10000000;
    num2 = num2 << 6;

    num3 = text[startIndex + 2] - 0b10000000;

    return num1 + num2 + num3;
}

/*********************************************************************************************************************/
/*-------------------------------------------------Extern Function---------------------------------------------------*/
/*********************************************************************************************************************/

uint32_t ParserChar_GetUnicode(const uint8_t* text /* Input */, uint8_t* outLen /* Output */)
{
    if (ParserChar_IsASCIIText(text[0]))
    {
        *outLen = 1;
        return (uint32_t)text[0];
    }
    else if (ParserChar_IsKoreanText(text, 0))
    {
        *outLen = 3;
        return ParserChar_GetUnicodeNumOfKorean(text, 0);
    }
    else
    {
        // 기타 2바이트, 4바이트 문자나 잘못된 경우 처리
        *outLen = 1;
        return (uint32_t)text[0];
    }
}